#!/usr/bin/bash

# Fix issue with at not having its /var/spool directories created on rpm-ostree install.
# This is a temporary workaround until we fix the issue with the RPM.
# See
# https://universal-blue.discourse.group/t/missing-new-var-subdirectories-when-adding-an-rpm-to-a-custom-image/1752/2

if [ "`id -u`" -ne 0 ]; then
    echo "You must be root to do this"
    exit 1
fi

set -e
if [ ! -d /var/spool/at ]; then
    logger "Creating directories in /var/spool for atd"
    install -d -m 700 /var/spool/at/spool
    touch /var/spool/at/.SEQ
    chmod 600 /var/spool/at/.SEQ
    fixfiles restore /var/spool/at
else
    logger "Directories for atd in /var/spool already exist"
fi
